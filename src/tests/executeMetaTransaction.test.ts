import { it, expect } from "vitest";
import { parseSwap } from "../index";

const RPC_TEST_URL = "https://polygon-rpc.com";

// https://polygonscan.com/tx/0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef
const txReceipt = {
  _type: "TransactionReceipt",
  blockHash:
    "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
  blockNumber: 41158717,
  contractAddress: null,
  cumulativeGasUsed: "11523566",
  from: "0xEFF023Bb006dA503414507062BB4B86291e8707f",
  gasPrice: "95746470026",
  gasUsed: "355245",
  hash: "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
  index: 70,
  logs: [
    {
      _type: "log",
      address: "0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x000000000000000000000000000000000000000000000000769a45b377c81000",
      index: 275,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x00000000000000000000000031664cb83f778d7c7b73923d2c7525b3856adea1",
        "0x000000000000000000000000db6f1920a889355780af7570773609bd8cb1f498",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x000000000000000000000000000000000000000000000000000000000097afdd",
      index: 276,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000a374094527e1673a86de625aa59517c5de346d32",
        "0x000000000000000000000000e592427a0aece92de3edee1f18e0157c05861564",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x000000000000000000000000000000000000000000000000769a45b377c81000",
      index: 277,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000db6f1920a889355780af7570773609bd8cb1f498",
        "0x000000000000000000000000a374094527e1673a86de625aa59517c5de346d32",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0xA374094527e1673A86dE625aa59517c5dE346d32",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x000000000000000000000000000000000000000000000000769a45b377c81000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6850230000000000000000000000000000000000000000000012195a9f8bea81acd2370000000000000000000000000000000000000000000000023cc1a8a33f0848fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbce88",
      index: 278,
      topics: [
        "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
        "0x000000000000000000000000e592427a0aece92de3edee1f18e0157c05861564",
        "0x000000000000000000000000e592427a0aece92de3edee1f18e0157c05861564",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0x553d3D295e0f695B9228246232eDF400ed3560B5",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x00000000000000000000000000000000000000000000000000115aa5b92dd104",
      index: 279,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000cca15d926b707119f6b74b559df3aaecc14f2d88",
        "0x000000000000000000000000db6f1920a889355780af7570773609bd8cb1f498",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x000000000000000000000000000000000000000000000000000000000097afdd",
      index: 280,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000e592427a0aece92de3edee1f18e0157c05861564",
        "0x000000000000000000000000cca15d926b707119f6b74b559df3aaecc14f2d88",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0xcCA15D926B707119F6B74B559DF3aaeCc14f2D88",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x000000000000000000000000000000000000000000000000000000000097afddffffffffffffffffffffffffffffffffffffffffffffffffffeea55a46d22efc00000000000000000000000000000000000056b7fc4582c781daf3d9e64c7ccd000000000000000000000000000000000000000000000000001a3baafd4c60200000000000000000000000000000000000000000000000000000000000030de6",
      index: 281,
      topics: [
        "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
        "0x000000000000000000000000e592427a0aece92de3edee1f18e0157c05861564",
        "0x000000000000000000000000db6f1920a889355780af7570773609bd8cb1f498",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0xdB6f1920A889355780aF7570773609Bd8Cb1f498",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x00000000000000000000000000000012556e69737761705633000000000000000000000000000000000000000d500b1d8e8ef31e21c99d1db9a6444d3adf1270000000000000000000000000553d3d295e0f695b9228246232edf400ed3560b5000000000000000000000000000000000000000000000000769a45b377c8100000000000000000000000000000000000000000000000000000115aa5b92dd104",
      index: 282,
      topics: [
        "0xe59e71a14fe90157eedc866c4f8c767d3943d6b6b2e8cd64dddcc92ab4c55af8",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0x553d3D295e0f695B9228246232eDF400ed3560B5",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x00000000000000000000000000000000000000000000000000115aa5b92dd104",
      index: 283,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000db6f1920a889355780af7570773609bd8cb1f498",
        "0x00000000000000000000000031664cb83f778d7c7b73923d2c7525b3856adea1",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0xDef1C0ded9bec7F1a1670819833240f027b25EfF",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x0000000000000000000000000d500b1d8e8ef31e21c99d1db9a6444d3adf1270000000000000000000000000553d3d295e0f695b9228246232edf400ed3560b5000000000000000000000000000000000000000000000000769a45b377c8100000000000000000000000000000000000000000000000000000115aa5b92dd104",
      index: 284,
      topics: [
        "0x0f6672f78a59ba8e5e5b5d38df3ebc67f3c792e2c9259b8d97d7f00dd78ba1b3",
        "0x00000000000000000000000031664cb83f778d7c7b73923d2c7525b3856adea1",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0xDef1C0ded9bec7F1a1670819833240f027b25EfF",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x8965801e1ffb5159f46aaa70d496f46652c90fea23373853076b65a88dff6cad00000000000000000000000031664cb83f778d7c7b73923d2c7525b3856adea10000000000000000000000000000000000000000000000000000000000000000",
      index: 285,
      topics: [
        "0x7f4fe3ff8ae440e1570c558da08440b26f89fb1c1f2910cd91ca6452955f121a",
        "0x415565b000000000000000000000000000000000000000000000000000000000",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
    {
      _type: "log",
      address: "0x0000000000000000000000000000000000001010",
      blockHash:
        "0xc36d68a3fd02de82b5f269e1da00b59484972ff31de481ad7602ce5dd13d9909",
      blockNumber: 41158717,
      data: "0x00000000000000000000000000000000000000000000000000271fe59507be000000000000000000000000000000000000000000000000006dc321e97d3e0236000000000000000000000000000000000000000000000027a6d282f8cd8f95440000000000000000000000000000000000000000000000006d9c0203e8364436000000000000000000000000000000000000000000000027a6f9a2de62975344",
      index: 286,
      topics: [
        "0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63",
        "0x0000000000000000000000000000000000000000000000000000000000001010",
        "0x000000000000000000000000eff023bb006da503414507062bb4b86291e8707f",
        "0x000000000000000000000000fb960a9450fc2f5dc8c6b1172932b678e287835f",
      ],
      transactionHash:
        "0xaa61b2058fafae1532565b6acadf47a8fe604518185f535e2780dd28d626e0ef",
      transactionIndex: 70,
    },
  ],
  logsBloom:
    "0x00008002400000008200001000000010000000000001000408000000000000000001000000000010000000000000000000008100000020000000000000000000000040000000408800000008800100800000000000000000000100040000000000020000000000000000501000000000000001000008000180000010000800000401000000000000000000000010020000000000000000000000000000200000208000000000420002000000a00001004000000040000000000000000000004001000002000000000001000000000000000040000000000000110000000000000000008400000000200000080000000400000000020000000000000000101800",
  status: 1,
  to: "0xDef1C0ded9bec7F1a1670819833240f027b25EfF",
};

it("parses swap for executeMetaTransaction", async () => {
  const data = await parseSwap({
    txReceipt,
    txDescription: {
      name: "executeMetaTransaction",
      value: 0n,
      args: [
        [
          "0x31664Cb83F778D7c7b73923d2C7525B3856aDeA1",
          "0x0000000000000000000000000000000000000000",
          0n,
          281474976710656n,
          1680667969n,
          79811209246722451623134147689819430775848477880561947478557515978224307364135n,
        ],
      ],
    },
    rpcUrl: RPC_TEST_URL,
  });

  expect(data).toEqual({
    tokenIn: {
      symbol: "WMATIC",
      amount: "8.54621988",
    },
    tokenOut: {
      symbol: "PAXG",
      amount: "0.00488474242697242",
    },
  });
});

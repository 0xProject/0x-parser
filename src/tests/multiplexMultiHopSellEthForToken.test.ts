import { it, expect } from "vitest";
import { parseSwap } from "../index";

require("dotenv").config();

const RPC_TEST_URL = process.env.RPC_TEST_URL;

if (!RPC_TEST_URL) {
  throw new Error("Missing environment variable `RPC_TEST_URL`");
}

// https://etherscan.io/tx/0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c
const txReceipt = {
  _type: "TransactionReceipt",
  blockHash:
    "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
  blockNumber: 16919715,
  contractAddress: null,
  cumulativeGasUsed: "10471794",
  from: "0x46F9F8f1AcBB45464fe8F0c48C54944753ea91bF",
  gasPrice: "53906673400",
  gasUsed: "270604",
  hash: "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
  index: 128,
  logs: [
    {
      address: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0x00000000000000000000000000000000000000000000000029a2241af62c0000",
      index: 278,
      topics: [
        "0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
    {
      address: "0x6B175474E89094C44Da98b954EedeAC495271d0F",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0x0000000000000000000000000000000000000000000001166773fa83f70417e3",
      index: 279,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x00000000000000000000000060594a405d53811d3bc4766596efd80fd545a270",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
    {
      address: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0x00000000000000000000000000000000000000000000000029a2241af62c0000",
      index: 280,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x00000000000000000000000060594a405d53811d3bc4766596efd80fd545a270",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
    {
      address: "0x60594a405d53811d3BC4766596EFD80fd545A270",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0xfffffffffffffffffffffffffffffffffffffffffffffee9988c057c08fbe81d00000000000000000000000000000000000000000000000029a2241af62c00000000000000000000000000000000000000000000062fa8dcf119e9368459d17e00000000000000000000000000000000000000000000cef56c86d4fe5a38d9e1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffedd23",
      index: 281,
      topics: [
        "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
    {
      address: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0x000000000000000000000000000000000000000000000000000000013215c4e3",
      index: 282,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x0000000000000000000000005777d92f208679db4b9778590fa3cab3ac9e2168",
        "0x0000000000000000000000003fa5db0910afc2a1e6de45039ea217410fb8641d",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
    {
      address: "0x6B175474E89094C44Da98b954EedeAC495271d0F",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0x0000000000000000000000000000000000000000000001166773fa83f70417e3",
      index: 283,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x0000000000000000000000005777d92f208679db4b9778590fa3cab3ac9e2168",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
    {
      address: "0x5777d92f208679DB4b9778590Fa3CAB3aC9e2168",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0x0000000000000000000000000000000000000000000001166773fa83f70417e3fffffffffffffffffffffffffffffffffffffffffffffffffffffffecdea3b1d0000000000000000000000000000000000000000000010c70459c6d6c2567d8e0000000000000000000000000000000000000000000072776df771037d18bcf7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbc89c",
      index: 284,
      topics: [
        "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x0000000000000000000000003fa5db0910afc2a1e6de45039ea217410fb8641d",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
    {
      address: "0x7659CE147D0e714454073a5dd7003544234b6Aa0",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0x000000000000000000000000000000000000000000000092b0d9884faf40ec09",
      index: 285,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x0000000000000000000000003fa5db0910afc2a1e6de45039ea217410fb8641d",
        "0x00000000000000000000000046f9f8f1acbb45464fe8f0c48c54944753ea91bf",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
    {
      address: "0x3fA5db0910Afc2A1E6DE45039eA217410fB8641d",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0x0000000000000000000000000000000000000000000059cb4180687c09a19d97000000000000000000000000000000000000000000000000000000bbff64a3c8",
      index: 286,
      topics: [
        "0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
    {
      address: "0x3fA5db0910Afc2A1E6DE45039eA217410fB8641d",
      blockHash:
        "0x71ff985e090210b74e91cdcba943f878b568a87d8db39df4754658d56c7dc24e",
      blockNumber: 16919715,
      data: "0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013215c4e3000000000000000000000000000000000000000000000092b0d9884faf40ec090000000000000000000000000000000000000000000000000000000000000000",
      index: 287,
      topics: [
        "0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x00000000000000000000000046f9f8f1acbb45464fe8f0c48c54944753ea91bf",
      ],
      transactionHash:
        "0x00b191d47269265cfbbc94c77a114281ee939463b7a922e8bfbf7de8bc150c5c",
      transactionIndex: 128,
    },
  ],
  logsBloom:
    "0x002000000000000000000040a2000000000000000000000000000040000000000000000000000000000000000000000002000000080020000000000001000000000280000000002808000008000000200000000000000000000000008000000010000000100000000000080000000040000000000000002000000010000800000000000000000001400000000000000000000001010000080100804000000000020000000000200000004000004020000000080000000000000000000000000000000002000000020000000000000000000002040000005000000000000000010000280000000000000000000000000000000000000000400000000000000000",
  status: 1,
  to: "0xDef1C0ded9bec7F1a1670819833240f027b25EfF",
};

it("parses swap for multiplexMultiHopSellEthForToken", async () => {
  const data = await parseSwap({
    txReceipt,
    txDescription: {
      name: "multiplexMultiHopSellEthForToken",
      value: 0n,
      args: [],
    },
    rpcUrl: RPC_TEST_URL,
  });

  expect(data).toEqual({
    tokenIn: {
      symbol: "WETH",
      amount: "3",
      address: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
    },
    tokenOut: {
      symbol: "XCAD",
      amount: "2705.968001258040126473",
      address: "0x7659CE147D0e714454073a5dd7003544234b6Aa0",
    },
  });
});

import { it, expect } from "vitest";
import { parseSwap } from "../index";

require("dotenv").config();

const RPC_TEST_URL = process.env.RPC_TEST_URL;

if (!RPC_TEST_URL) {
  throw new Error("Missing environment variable `RPC_TEST_URL`");
}

// https://etherscan.io/tx/0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e
const txReceipt = {
  _type: "TransactionReceipt",
  blockHash:
    "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
  blockNumber: 16594209,
  contractAddress: null,
  cumulativeGasUsed: "8002583",
  from: "0xa9531D3B5483bef6FaE3B4Be62Ccd83697aB92b1",
  gasPrice: "43687383816",
  gasUsed: "315723",
  hash: "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
  index: 50,
  logs: [
    {
      address: "0x3B9BE07d622aCcAEd78f479BC0EDabFd6397E320",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x00000000000000000000000000000000000000000000043fc767caa5e96fdd4c",
      index: 192,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000a9531d3b5483bef6fae3b4be62ccd83697ab92b1",
        "0x00000000000000000000000062e3c242b5e903071458ad90a160493d84911c77",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0x3B9BE07d622aCcAEd78f479BC0EDabFd6397E320",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0xfffffffffffffffffffffffffffffffffffffffffffffbc03898355a169022b3",
      index: 193,
      topics: [
        "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925",
        "0x000000000000000000000000a9531d3b5483bef6fae3b4be62ccd83697ab92b1",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0xdAC17F958D2ee523a2206206994597C13D831ec7",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x0000000000000000000000000000000000000000000000000000000130edc3eb",
      index: 194,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x00000000000000000000000062e3c242b5e903071458ad90a160493d84911c77",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0x62e3C242B5e903071458ad90A160493D84911C77",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x000000000000000000000000000000000000000000014bb124b98994a34fa89c0000000000000000000000000000000000000000000000000000005c10d4e639",
      index: 195,
      topics: [
        "0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0x62e3C242B5e903071458ad90A160493D84911C77",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x00000000000000000000000000000000000000000000043fc767caa5e96fdd4c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000130edc3eb",
      index: 196,
      topics: [
        "0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0x6B175474E89094C44Da98b954EedeAC495271d0F",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x0000000000000000000000000000000000000000000001155e74cc14f507c4a5",
      index: 197,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x00000000000000000000000048da0965ab2d2cbf1c17c09cfb5cbe67ad5b1406",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0xdAC17F958D2ee523a2206206994597C13D831ec7",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x0000000000000000000000000000000000000000000000000000000130edc3eb",
      index: 198,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x00000000000000000000000048da0965ab2d2cbf1c17c09cfb5cbe67ad5b1406",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0x48DA0965ab2d2cbf1C17C09cFB5Cbe67Ad5B1406",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0xfffffffffffffffffffffffffffffffffffffffffffffeeaa18b33eb0af83b5b0000000000000000000000000000000000000000000000000000000130edc3eb0000000000000000000000000000000000000000000010c6768f588cef97d93c00000000000000000000000000000000000000000000009e14b6c1b0cfff72acfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbc899",
      index: 199,
      topics: [
        "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x0000000000000000000000000000000000000000000000002de062d4be9f5925",
      index: 200,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x00000000000000000000000060594a405d53811d3bc4766596efd80fd545a270",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0x6B175474E89094C44Da98b954EedeAC495271d0F",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x0000000000000000000000000000000000000000000001155e74cc14f507c4a5",
      index: 201,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x00000000000000000000000060594a405d53811d3bc4766596efd80fd545a270",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0x60594a405d53811d3BC4766596EFD80fd545A270",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x0000000000000000000000000000000000000000000001155e74cc14f507c4a5ffffffffffffffffffffffffffffffffffffffffffffffffd21f9d2b4160a6db000000000000000000000000000000000000000006820d7564a8957a420f329f0000000000000000000000000000000000000000000081b9f1aec8314b596b09fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffee119",
      index: 202,
      topics: [
        "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
    {
      address: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
      blockHash:
        "0x0f7fbc04f4649286a90b0085456e7c0ae975786ce2af5405ebd52dbee68b99fd",
      blockNumber: 16594209,
      data: "0x0000000000000000000000000000000000000000000000002de062d4be9f5925",
      index: 203,
      topics: [
        "0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xba3a89b2164e5f169bc81e90a13f8946d110dffe2b53393953ea2a4fede8e81e",
      transactionIndex: 50,
    },
  ],
  logsBloom:
    "0x002000000000000000020000a0000001000000000000000000000040000000000200000000000000000000000000010002000000080020000000004000220040000000000000002800000008000000200000000000c00000000100000100000010000000000000000000080000000040000800000000042100004010000800000000000000000000000000000000000000000000000000080000404000100000020000000000000000004080000000000040080000000080000000000000000000000002000000020000000000000000000002000000001000000002000040000010200000000000000000000000000000000000000000000000000040000000",
  status: 1,
  to: "0xDef1C0ded9bec7F1a1670819833240f027b25EfF",
};

it("parses swap for multiplexMultiHopSellTokenForEth", async () => {
  const data = await parseSwap({
    txReceipt,
    txDescription: {
      name: "multiplexMultiHopSellTokenForEth",
      value: 0n,
      args: [],
    },
    rpcUrl: RPC_TEST_URL,
  });

  expect(data).toEqual({
    tokenIn: { symbol: "LSS", amount: "20065.979484072366300492" },
    tokenOut: { symbol: "WETH", amount: "3.305750792360646949" },
  });
});

import { it, expect } from "vitest";
import { parseSwap } from "../index";

require("dotenv").config();

const RPC_TEST_URL = process.env.RPC_TEST_URL;

if (!RPC_TEST_URL) {
  throw new Error("Missing environment variable `RPC_TEST_URL`");
}

// https://etherscan.io/tx/0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d
const txReceipt = {
  _type: "TransactionReceipt",
  blockHash:
    "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
  blockNumber: 16853425,
  contractAddress: null,
  cumulativeGasUsed: "8070380",
  from: "0x7204dA7b2fc2278E08702459d1d9Aa56A2E9385e",
  gasPrice: "17571938772",
  gasUsed: "257191",
  hash: "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
  index: 82,
  logs: [
    {
      _type: "log",
      address: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
      blockHash:
        "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
      blockNumber: 16853425,
      data: "0x0000000000000000000000000000000000000000000000001bdbae66ba6d021c",
      index: 180,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000a6cc3c2531fdaa6ae1a3ca84c2855806728693e8",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
      transactionIndex: 82,
    },
    {
      _type: "log",
      address: "0x514910771AF9Ca656af840dff83E8264EcF986CA",
      blockHash:
        "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
      blockNumber: 16853425,
      data: "0x00000000000000000000000000000000000000000000001b4fcd8c583db27000",
      index: 181,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x0000000000000000000000007204da7b2fc2278e08702459d1d9aa56a2e9385e",
        "0x000000000000000000000000a6cc3c2531fdaa6ae1a3ca84c2855806728693e8",
      ],
      transactionHash:
        "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
      transactionIndex: 82,
    },
    {
      _type: "log",
      address: "0xa6Cc3C2531FdaA6Ae1A3CA84c2855806728693e8",
      blockHash:
        "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
      blockNumber: 16853425,
      data: "0x00000000000000000000000000000000000000000000001b4fcd8c583db27000ffffffffffffffffffffffffffffffffffffffffffffffffe42451994592fde40000000000000000000000000000000000000000102ef0c2d24c67aff3014f53000000000000000000000000000000000000000000012136ebf313e73925f9ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff2845",
      index: 182,
      topics: [
        "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
      ],
      transactionHash:
        "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
      transactionIndex: 82,
    },
    {
      _type: "log",
      address: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
      blockHash:
        "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
      blockNumber: 16853425,
      data: "0x00000000000000000000000000000000000000000000000000000000d81d13b1",
      index: 183,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640",
        "0x0000000000000000000000004cd36d6f32586177e36179a810595a33163a20bf",
      ],
      transactionHash:
        "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
      transactionIndex: 82,
    },
    {
      _type: "log",
      address: "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
      blockHash:
        "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
      blockNumber: 16853425,
      data: "0x0000000000000000000000000000000000000000000000001bdbae66ba6d021c",
      index: 184,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640",
      ],
      transactionHash:
        "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
      transactionIndex: 82,
    },
    {
      _type: "log",
      address: "0x88e6A0c2dDD26FEEb64F039a2c41296FcB3f5640",
      blockHash:
        "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
      blockNumber: 16853425,
      data: "0xffffffffffffffffffffffffffffffffffffffffffffffffffffffff27e2ec4f0000000000000000000000000000000000000000000000001bdbae66ba6d021c0000000000000000000000000000000000005be3c301aadc9706db4179ce4a6b000000000000000000000000000000000000000000000002091ae7c1b1372110000000000000000000000000000000000000000000000000000000000003126d",
      index: 185,
      topics: [
        "0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x0000000000000000000000004cd36d6f32586177e36179a810595a33163a20bf",
      ],
      transactionHash:
        "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
      transactionIndex: 82,
    },
    {
      _type: "log",
      address: "0x0f51bb10119727a7e5eA3538074fb341F56B09Ad",
      blockHash:
        "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
      blockNumber: 16853425,
      data: "0x00000000000000000000000000000000000000000000006d305bf905ae384f60",
      index: 186,
      topics: [
        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
        "0x0000000000000000000000004cd36d6f32586177e36179a810595a33163a20bf",
        "0x0000000000000000000000007204da7b2fc2278e08702459d1d9aa56a2e9385e",
      ],
      transactionHash:
        "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
      transactionIndex: 82,
    },
    {
      _type: "log",
      address: "0x4cd36d6F32586177e36179a810595a33163a20BF",
      blockHash:
        "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
      blockNumber: 16853425,
      data: "0x000000000000000000000000000000000000000000005fdcfcc2fd8d5d1e614a000000000000000000000000000000000000000000000000000000be0377e0d8",
      index: 187,
      topics: [
        "0x1c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1",
      ],
      transactionHash:
        "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
      transactionIndex: 82,
    },
    {
      _type: "log",
      address: "0x4cd36d6F32586177e36179a810595a33163a20BF",
      blockHash:
        "0x346781166e37d92c27d51f900f32d3f5b5bada633be84feccde259d165f2b582",
      blockNumber: 16853425,
      data: "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d81d13b100000000000000000000000000000000000000000000006d305bf905ae384f600000000000000000000000000000000000000000000000000000000000000000",
      index: 188,
      topics: [
        "0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822",
        "0x000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff",
        "0x0000000000000000000000007204da7b2fc2278e08702459d1d9aa56a2e9385e",
      ],
      transactionHash:
        "0xf705df9127065ae8a8da3c1939d7096011ea13c81e4a2ed8c59ea1b039f7565d",
      transactionIndex: 82,
    },
  ],
  logsBloom:
    "0x00200000011000000000000080001000200000000000000000000000040000000000000000000000000008000000000002000020080020000000000000000000000001000000002848000108000000201000000000000000000000000000800022000000000000400000000000000040800000000000000000800010000800000020000000000000000000000000000000000000010000080000004000000000000000040000200000004000000000000000000000000000002000000008000000000002000000000000000000000006000000000000001000000000000000000000600800000000000010000000000000000100000000000000000000000000",
  status: 1,
  to: "0xDef1C0ded9bec7F1a1670819833240f027b25EfF",
};

it("parses swap for multiplexMultiHopSellTokenForToken", async () => {
  const data = await parseSwap({
    txReceipt,
    txDescription: {
      name: "multiplexMultiHopSellTokenForToken",
      value: 0n,
      args: [],
    },
    rpcUrl: RPC_TEST_URL,
  });

  expect(data).toEqual({
    tokenIn: { symbol: "LINK", amount: "503.8124966" },
    tokenOut: { symbol: "DAO", amount: "2014.179756573835415392" },
  });
});
